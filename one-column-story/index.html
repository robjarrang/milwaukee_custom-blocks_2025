<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>2 Column Story Block</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/quill/1.3.7/quill.snow.css">
    <link rel="stylesheet" href="https://cloud.mail.milwaukeetool.eu/customblock-styles">
    <style>
        body{margin:0;padding:10px;font-family:Arial,sans-serif;background-color:white}.container{max-width:800px;margin:0 auto;background:white;padding:20px;border-radius:8px;;transition:opacity 0.3s ease}.container.loading{opacity:0.6;pointer-events:none}.field-group{margin-bottom:20px}.field-label{display:block;margin-bottom:5px;font-weight:bold;color:#333;font-size:14px}.field-input{width:100%;padding:8px 12px;border:1px solid #ddd;border-radius:4px;font-size:14px;box-sizing:border-box;transition:border-color 0.3s ease}.field-input:focus{outline:none;border-color:#0074d9;box-shadow:0 0 0 2px rgba(0,116,217,0.2)}.field-input.error{border-color:#ff0000}.field-error{color:#ff0000;font-size:12px;margin-top:4px;display:none}.field-input.error + .field-error{display:block}.checkbox-label{cursor:pointer;user-select:none;font-size:14px;color:#333}.color-selector,.option-selector{display:flex;gap:10px}.color-option,.option-button{flex:1;padding:8px;text-align:center;border:2px solid #ddd;border-radius:4px;cursor:pointer;transition:all .2s ease}.color-option:hover,.option-button:hover{border-color:#0074d9;background-color:#f0f8ff}.color-option.selected,.option-button.selected{border-color:#0074d9;background-color:#0074d9;color:white}.toggle-container{display:flex;align-items:center;gap:10px;margin-bottom:15px}.toggle-switch{position:relative;display:inline-block;width:48px;height:24px}.toggle-switch input{opacity:0;width:0;height:0}.toggle-slider{position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background-color:#ccc;transition:.3s;border-radius:24px}.toggle-slider:before{position:absolute;content:"";height:18px;width:18px;left:3px;bottom:3px;background-color:white;transition:.3s;border-radius:50%}input:checked + .toggle-slider{background-color:#0074d9}input:checked + .toggle-slider:before{transform:translateX(24px)}.disabled-field{opacity:0.5;pointer-events:none}.quill-container{background:white;border:1px solid #ddd;border-radius:4px}.ql-toolbar{border:none;border-bottom:1px solid #ddd;border-radius:4px 4px 0 0}.ql-container{border:none;border-radius:0 0 4px 4px;font-size:14px}.ql-editor{min-height:60px;padding:12px}.limited-toolbar .ql-toolbar{padding:5px}.limited-toolbar .ql-toolbar button{width:24px;height:24px}.section-divider{margin:30px 0;border-top:2px solid #eee;padding-top:20px}.section-title{font-size:16px;font-weight:bold;color:#333;margin-bottom:15px}.column-wrapper{display:flex;gap:20px;flex-wrap:wrap}.column{flex:1;min-width:300px;background-color:#fafafa;padding:15px;border-radius:6px;border:1px solid #eee}.loading-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(255,255,255,0.9);display:none;align-items:center;justify-content:center;z-index:9999}.loading-overlay.show{display:flex}.loading-spinner{border:3px solid #f3f3f3;border-top:3px solid #0074d9;border-radius:50%;width:40px;height:40px;animation:spin 1s linear infinite}@keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}.error-banner{background-color:#fee;border:1px solid #fcc;color:#c00;padding:10px;margin-bottom:20px;border-radius:4px;display:none}.error-banner.show{display:block}
        .option-button svg { display: block; margin: 0 auto; fill: currentColor; }
        .style-controls-wrapper { display: flex; justify-content: space-between; align-items: center; gap: 20px; margin-top: 15px; }
        .style-control-group .field-label { margin-bottom: 5px; }
        .style-control-group .field-input { width: 80px; padding: 6px 8px; }
        .style-control-group .option-selector { width: 140px; }
    </style>
</head>
<body>
    <div class="loading-overlay" id="loadingOverlay"><div class="loading-spinner"></div></div>
    <div class="container" id="mainContainer">
        <h2 style="margin-top: 0; color: #333;">2 Column Story</h2>
        <div class="error-banner" id="errorBanner"></div>
        <div class="section-divider" style="margin-top:0; padding-top:0; border-top:none;"><div class="section-title">General Settings</div><div class="field-group"><label class="field-label">Background Colour</label><div class="color-selector" id="backgroundColorSelector"><div class="color-option selected" data-color="black">Black</div><div class="color-option" data-color="red">Red</div></div></div></div>
        <div class="column-wrapper">
            <div class="column"><div class="section-title" style="margin-top:0;">Left Column</div><div class="field-group"><label for="left_imageUrl" class="field-label">Image URL</label><input type="url" id="left_imageUrl" class="field-input"><div class="field-error" id="left_imageUrlError">Please enter a valid image URL.</div></div><div class="field-group"><label for="left_imageAlt" class="field-label">Image Alt Text</label><input type="text" id="left_imageAlt" class="field-input"></div><div class="field-group"><label for="left_imageLink" class="field-label">Image Link URL</label><input type="url" id="left_imageLink" class="field-input"><div class="field-error" id="left_imageLinkError">Please enter a valid URL.</div></div><div class="section-divider" style="margin:20px 0; padding-top: 15px;"></div><div class="toggle-container"><label class="toggle-switch"><input type="checkbox" id="left_showSubtitle" checked><span class="toggle-slider"></span></label><label for="left_showSubtitle" class="checkbox-label">Show Subtitle</label></div><div class="field-group" id="left_subtitleGroup"><label for="left_subtitle" class="field-label">Subtitle</label><input type="text" id="left_subtitle" class="field-input"><div class="style-controls-wrapper"><div class="style-control-group"><label class="field-label">Font Size</label><input type="number" id="left_subtitleFontSize" class="field-input" min="12" max="24" step="4"></div><div class="style-control-group"><label class="field-label">Alignment</label><div class="option-selector" id="left_subtitleAlignmentSelector"><div class="option-button" data-value="left" title="Align Left"><svg width="24" height="24" viewBox="0 0 24 24"><path d="M4 19h16v-2H4v2zm0-4h10v-2H4v2zm0-4h16v-2H4v2zM4 5v2h10V5H4z"/></svg></div><div class="option-button selected" data-value="center" title="Align Center"><svg width="24" height="24" viewBox="0 0 24 24"><path d="M4 19h16v-2H4v2zm4-4h8v-2H8v2zm-4-4h16v-2H4v2zm4-4h8V5H8v2z"/></svg></div><div class="option-button" data-value="right" title="Align Right"><svg width="24" height="24" viewBox="0 0 24 24"><path d="M4 19h16v-2H4v2zm6-4h10v-2H10v2zM4 9h16V7H4v2zm6-4h10V3H10v2z"/></svg></div></div></div></div></div><div class="field-group"><label class="field-label">Title</label><div id="left_titleEditor" class="quill-container limited-toolbar"></div><div class="style-controls-wrapper"><div class="style-control-group"><label class="field-label">Font Size</label><input type="number" id="left_titleFontSize" class="field-input" min="16" max="32" step="4"></div><div class="style-control-group"><label class="field-label">Alignment</label><div class="option-selector" id="left_titleAlignmentSelector"><div class="option-button" data-value="left" title="Align Left"><svg width="24" height="24" viewBox="0 0 24 24"><path d="M4 19h16v-2H4v2zm0-4h10v-2H4v2zm0-4h16v-2H4v2zM4 5v2h10V5H4z"/></svg></div><div class="option-button selected" data-value="center" title="Align Center"><svg width="24" height="24" viewBox="0 0 24 24"><path d="M4 19h16v-2H4v2zm4-4h8v-2H8v2zm-4-4h16v-2H4v2zm4-4h8V5H8v2z"/></svg></div><div class="option-button" data-value="right" title="Align Right"><svg width="24" height="24" viewBox="0 0 24 24"><path d="M4 19h16v-2H4v2zm6-4h10v-2H10v2zM4 9h16V7H4v2zm6-4h10V3H10v2z"/></svg></div></div></div></div></div><div class="field-group"><label class="field-label">Description</label><div id="left_descriptionEditor" class="quill-container"></div><div class="style-controls-wrapper"><div class="style-control-group"><label class="field-label">Font Size</label><input type="number" id="left_descriptionFontSize" class="field-input" min="12" max="24" step="4"></div><div class="style-control-group"><label class="field-label">Alignment</label><div class="option-selector" id="left_descriptionAlignmentSelector"><div class="option-button" data-value="left" title="Align Left"><svg width="24" height="24" viewBox="0 0 24 24"><path d="M4 19h16v-2H4v2zm0-4h10v-2H4v2zm0-4h16v-2H4v2zM4 5v2h10V5H4z"/></svg></div><div class="option-button selected" data-value="center" title="Align Center"><svg width="24" height="24" viewBox="0 0 24 24"><path d="M4 19h16v-2H4v2zm4-4h8v-2H8v2zm-4-4h16v-2H4v2zm4-4h8V5H8v2z"/></svg></div><div class="option-button" data-value="right" title="Align Right"><svg width="24" height="24" viewBox="0 0 24 24"><path d="M4 19h16v-2H4v2zm6-4h10v-2H10v2zM4 9h16V7H4v2zm6-4h10V3H10v2z"/></svg></div></div></div></div></div><div class="section-divider" style="margin:20px 0; padding-top: 15px;"></div><div class="toggle-container"><label class="toggle-switch"><input type="checkbox" id="left_showButton" checked><span class="toggle-slider"></span></label><label for="left_showButton" class="checkbox-label">Show Button</label></div><div id="left_buttonFieldsGroup"><div class="field-group"><label for="left_buttonText" class="field-label">Button Text</label><input type="text" id="left_buttonText" class="field-input"></div><div class="field-group"><label for="left_buttonLink" class="field-label">Button Link URL</label><input type="url" id="left_buttonLink" class="field-input"><div class="field-error" id="left_buttonLinkError">Please enter a valid URL.</div></div><div class="style-controls-wrapper"><div class="style-control-group"><label class="field-label">Button Alignment</label><div class="option-selector" id="left_buttonAlignmentSelector"><div class="option-button" data-value="left" title="Align Left"><svg width="24" height="24" viewBox="0 0 24 24"><path d="M4 19h16v-2H4v2zm0-4h10v-2H4v2zm0-4h16v-2H4v2zM4 5v2h10V5H4z"/></svg></div><div class="option-button selected" data-value="center" title="Align Center"><svg width="24" height="24" viewBox="0 0 24 24"><path d="M4 19h16v-2H4v2zm4-4h8v-2H8v2zm-4-4h16v-2H4v2zm4-4h8V5H8v2z"/></svg></div><div class="option-button" data-value="right" title="Align Right"><svg width="24" height="24" viewBox="0 0 24 24"><path d="M4 19h16v-2H4v2zm6-4h10v-2H10v2zM4 9h16V7H4v2zm6-4h10V3H10v2z"/></svg></div></div></div></div></div></div>
            <div class="column"><div class="section-title" style="margin-top:0;">Right Column</div><div class="field-group"><label for="right_imageUrl" class="field-label">Image URL</label><input type="url" id="right_imageUrl" class="field-input"><div class="field-error" id="right_imageUrlError">Please enter a valid image URL.</div></div><div class="field-group"><label for="right_imageAlt" class="field-label">Image Alt Text</label><input type="text" id="right_imageAlt" class="field-input"></div><div class="field-group"><label for="right_imageLink" class="field-label">Image Link URL</label><input type="url" id="right_imageLink" class="field-input"><div class="field-error" id="right_imageLinkError">Please enter a valid URL.</div></div><div class="section-divider" style="margin:20px 0; padding-top: 15px;"></div><div class="toggle-container"><label class="toggle-switch"><input type="checkbox" id="right_showSubtitle" checked><span class="toggle-slider"></span></label><label for="right_showSubtitle" class="checkbox-label">Show Subtitle</label></div><div class="field-group" id="right_subtitleGroup"><label for="right_subtitle" class="field-label">Subtitle</label><input type="text" id="right_subtitle" class="field-input"><div class="style-controls-wrapper"><div class="style-control-group"><label class="field-label">Font Size</label><input type="number" id="right_subtitleFontSize" class="field-input" min="12" max="24" step="4"></div><div class="style-control-group"><label class="field-label">Alignment</label><div class="option-selector" id="right_subtitleAlignmentSelector"><div class="option-button" data-value="left" title="Align Left"><svg width="24" height="24" viewBox="0 0 24 24"><path d="M4 19h16v-2H4v2zm0-4h10v-2H4v2zm0-4h16v-2H4v2zM4 5v2h10V5H4z"/></svg></div><div class="option-button selected" data-value="center" title="Align Center"><svg width="24" height="24" viewBox="0 0 24 24"><path d="M4 19h16v-2H4v2zm4-4h8v-2H8v2zm-4-4h16v-2H4v2zm4-4h8V5H8v2z"/></svg></div><div class="option-button" data-value="right" title="Align Right"><svg width="24" height="24" viewBox="0 0 24 24"><path d="M4 19h16v-2H4v2zm6-4h10v-2H10v2zM4 9h16V7H4v2zm6-4h10V3H10v2z"/></svg></div></div></div></div></div><div class="field-group"><label class="field-label">Title</label><div id="right_titleEditor" class="quill-container limited-toolbar"></div><div class="style-controls-wrapper"><div class="style-control-group"><label class="field-label">Font Size</label><input type="number" id="right_titleFontSize" class="field-input" min="16" max="32" step="4"></div><div class="style-control-group"><label class="field-label">Alignment</label><div class="option-selector" id="right_titleAlignmentSelector"><div class="option-button" data-value="left" title="Align Left"><svg width="24" height="24" viewBox="0 0 24 24"><path d="M4 19h16v-2H4v2zm0-4h10v-2H4v2zm0-4h16v-2H4v2zM4 5v2h10V5H4z"/></svg></div><div class="option-button selected" data-value="center" title="Align Center"><svg width="24" height="24" viewBox="0 0 24 24"><path d="M4 19h16v-2H4v2zm4-4h8v-2H8v2zm-4-4h16v-2H4v2zm4-4h8V5H8v2z"/></svg></div><div class="option-button" data-value="right" title="Align Right"><svg width="24" height="24" viewBox="0 0 24 24"><path d="M4 19h16v-2H4v2zm6-4h10v-2H10v2zM4 9h16V7H4v2zm6-4h10V3H10v2z"/></svg></div></div></div></div></div><div class="field-group"><label class="field-label">Description</label><div id="right_descriptionEditor" class="quill-container"></div><div class="style-controls-wrapper"><div class="style-control-group"><label class="field-label">Font Size</label><input type="number" id="right_descriptionFontSize" class="field-input" min="12" max="24" step="4"></div><div class="style-control-group"><label class="field-label">Alignment</label><div class="option-selector" id="right_descriptionAlignmentSelector"><div class="option-button" data-value="left" title="Align Left"><svg width="24" height="24" viewBox="0 0 24 24"><path d="M4 19h16v-2H4v2zm0-4h10v-2H4v2zm0-4h16v-2H4v2zM4 5v2h10V5H4z"/></svg></div><div class="option-button selected" data-value="center" title="Align Center"><svg width="24" height="24" viewBox="0 0 24 24"><path d="M4 19h16v-2H4v2zm4-4h8v-2H8v2zm-4-4h16v-2H4v2zm4-4h8V5H8v2z"/></svg></div><div class="option-button" data-value="right" title="Align Right"><svg width="24" height="24" viewBox="0 0 24 24"><path d="M4 19h16v-2H4v2zm6-4h10v-2H10v2zM4 9h16V7H4v2zm6-4h10V3H10v2z"/></svg></div></div></div></div></div><div class="section-divider" style="margin:20px 0; padding-top: 15px;"></div><div class="toggle-container"><label class="toggle-switch"><input type="checkbox" id="right_showButton" checked><span class="toggle-slider"></span></label><label for="right_showButton" class="checkbox-label">Show Button</label></div><div id="right_buttonFieldsGroup"><div class="field-group"><label for="right_buttonText" class="field-label">Button Text</label><input type="text" id="right_buttonText" class="field-input"></div><div class="field-group"><label for="right_buttonLink" class="field-label">Button Link URL</label><input type="url" id="right_buttonLink" class="field-input"><div class="field-error" id="right_buttonLinkError">Please enter a valid URL.</div></div><div class="style-controls-wrapper"><div class="style-control-group"><label class="field-label">Button Alignment</label><div class="option-selector" id="right_buttonAlignmentSelector"><div class="option-button" data-value="left" title="Align Left"><svg width="24" height="24" viewBox="0 0 24 24"><path d="M4 19h16v-2H4v2zm0-4h10v-2H4v2zm0-4h16v-2H4v2zM4 5v2h10V5H4z"/></svg></div><div class="option-button selected" data-value="center" title="Align Center"><svg width="24" height="24" viewBox="0 0 24 24"><path d="M4 19h16v-2H4v2zm4-4h8v-2H8v2zm-4-4h16v-2H4v2zm4-4h8V5H8v2z"/></svg></div><div class="option-button" data-value="right" title="Align Right"><svg width="24" height="24" viewBox="0 0 24 24"><path d="M4 19h16v-2H4v2zm6-4h10v-2H10v2zM4 9h16V7H4v2zm6-4h10V3H10v2z"/></svg></div></div></div></div></div></div>
        </div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/quill/1.3.7/quill.min.js"></script>
    <script src="https://cloud.mail.milwaukeetool.eu/customblock-base"></script>
    <script src="https://cloud.mail.milwaukeetool.eu/customblock-blocksdk"></script>
    <script>
        'use strict';
        const moduleConfig={name:'2 Column Story',fields:{backgroundColor:{type:'text',defaultValue:'black'},left_imageUrl:{type:'url',defaultValue:'https://placehold.co/280x180/cccccc/333333?text=Image',validator:'url'},left_imageAlt:{type:'text',defaultValue:'Story image',maxLength:150},left_imageLink:{type:'url',defaultValue:'https://www.milwaukeetool.eu/',validator:'url'},left_showSubtitle:{type:'boolean',defaultValue:!0},left_subtitle:{type:'text',defaultValue:'M12 FHAC16-502X',maxLength:80},left_subtitleFontSize:{type:'number',defaultValue:16},left_subtitleAlignment:{type:'text',defaultValue:'center'},left_title:{type:'richtext',defaultValue:'Left Column Title',maxLength:100},left_titleFontSize:{type:'number',defaultValue:20},left_titleAlignment:{type:'text',defaultValue:'center'},left_description:{type:'richtext',defaultValue:'Sed vitae aliquet neque. Integer arcu nulla, dictum id ipsum quis, varius tempor dolor.',maxLength:250},left_descriptionFontSize:{type:'number',defaultValue:16},left_descriptionAlignment:{type:'text',defaultValue:'center'},left_showButton:{type:'boolean',defaultValue:!0},left_buttonText:{type:'text',defaultValue:'Learn More',maxLength:40},left_buttonLink:{type:'url',defaultValue:'https://www.milwaukeetool.eu/',validator:'url'},left_buttonAlignment:{type:'text',defaultValue:'center'},right_imageUrl:{type:'url',defaultValue:'https://placehold.co/280x180/cccccc/333333?text=Image',validator:'url'},right_imageAlt:{type:'text',defaultValue:'Story image',maxLength:150},right_imageLink:{type:'url',defaultValue:'https://www.milwaukeetool.eu/',validator:'url'},right_showSubtitle:{type:'boolean',defaultValue:!0},right_subtitle:{type:'text',defaultValue:'M12 SIM-0',maxLength:80},right_subtitleFontSize:{type:'number',defaultValue:16},right_subtitleAlignment:{type:'text',defaultValue:'center'},right_title:{type:'richtext',defaultValue:'Right Column Title',maxLength:100},right_titleFontSize:{type:'number',defaultValue:20},right_titleAlignment:{type:'text',defaultValue:'center'},right_description:{type:'richtext',defaultValue:'Sed vitae aliquet neque. Integer arcu nulla, dictum id ipsum quis, varius tempor dolor.',maxLength:250},right_descriptionFontSize:{type:'number',defaultValue:16},right_descriptionAlignment:{type:'text',defaultValue:'center'},right_showButton:{type:'boolean',defaultValue:!0},right_buttonText:{type:'text',defaultValue:'Find Out More',maxLength:40},right_buttonLink:{type:'url',defaultValue:'https://www.milwaukeetool.eu/',validator:'url'},right_buttonAlignment:{type:'text',defaultValue:'center'}},debounceDelay:300,maxRetries:3};
        const state={sdk:null,editors:{},blockData:{},isLoading:!1,isInitialized:!1,eventListeners:[]},elements={};
        const utils={debounce(t,e){let o;return function(...n){const i=()=>{clearTimeout(o),t.apply(this,n)};clearTimeout(o),o=setTimeout(i,e)}},isValidUrl(t){if(!t||""===t.trim())return!0;try{const e=new URL(t);return"http:"===e.protocol||"https:"===e.protocol}catch(t){return!1}},sanitizeHtml(t){if(!t)return"";const e=document.createElement("div");e.innerHTML=t,e.querySelectorAll("script, style").forEach(t=>t.remove());const o=e.getElementsByTagName("*");for(let t of o)for(let e of t.attributes)e.name.startsWith("on")&&t.removeAttribute(e.name);return e.innerHTML},showError(t,e=!1){elements.errorBanner&&(elements.errorBanner.textContent=t,elements.errorBanner.classList.add("show"),e||setTimeout(()=>elements.errorBanner.classList.remove("show"),5e3)),console.error(`${moduleConfig.name} Error:`,t)},getFieldValue(t){const e=state.blockData[t],o=moduleConfig.fields[t];return void 0!==e&&null!==e?"number"===o.type?parseFloat(e):e:o.defaultValue}};
        function cacheElements(){elements.mainContainer=document.getElementById("mainContainer"),elements.loadingOverlay=document.getElementById("loadingOverlay"),elements.errorBanner=document.getElementById("errorBanner"),elements.backgroundColorSelector=document.getElementById("backgroundColorSelector");const t=["left_","right_"];t.forEach(t=>{["imageUrl","imageAlt","imageLink","subtitle","subtitleFontSize","subtitleAlignmentSelector","titleEditor","titleFontSize","titleAlignmentSelector","descriptionEditor","descriptionFontSize","descriptionAlignmentSelector","buttonText","buttonLink","buttonAlignmentSelector"].forEach(e=>{elements[t+e]=document.getElementById(t+e)}),["imageUrlError","imageLinkError","buttonLinkError","showSubtitle","subtitleGroup","showButton","buttonFieldsGroup"].forEach(e=>{elements[t+e]=document.getElementById(t+e)})})}
        function setLoadingState(t){state.isLoading=t,elements.mainContainer&&elements.loadingOverlay&&(elements.mainContainer.classList.toggle("loading",t),elements.loadingOverlay.classList.toggle("show",t))}
        function initializeEditors(){if(!window.Quill)throw new Error("Quill library not loaded");const t=["left_","right_"];t.forEach(t=>{try{state.editors[t+"title"]=new Quill(elements[t+"titleEditor"],{theme:"snow",modules:{toolbar:[["bold"]],clipboard:{matchVisual:!1}},formats:["bold"],placeholder:"Enter title..."}),state.editors[t+"description"]=new Quill(elements[t+"descriptionEditor"],{theme:"snow",modules:{toolbar:[["bold","italic"],["link"]],clipboard:{matchVisual:!1}},formats:["bold","italic","link"],placeholder:"Enter description..."}),["title","description"].forEach(e=>{const o=state.editors[t+e],n=t+e,i=utils.debounce((t,i,l)=>{l==="user"&&updateData(n,utils.sanitizeHtml(o.root.innerHTML))},moduleConfig.debounceDelay);o.on("text-change",i),o.on("text-change",()=>{const t=o.getText(),i=moduleConfig.fields[n].maxLength;t.length>i&&o.deleteText(i,t.length)})})}catch(e){throw new Error(`Failed to initialize ${t} editors: ${e.message}`)}})}
        function processRichText(t,e=!1){if(!t)return"";const o=document.createElement("div");return o.innerHTML=utils.sanitizeHtml(t),e&&o.querySelectorAll("a").forEach(t=>{t.style.color||(t.style.color="#ffffff"),t.style.textDecoration="underline",t.getAttribute("href")||t.setAttribute("href","#")}),o.innerHTML.replace(/<p>|<\/p>|<br>/g,"")}
        function updateData(t,e){state.blockData[t]!=e&&(state.blockData[t]=e,refreshPreview())}const debouncedUpdateData=utils.debounce(updateData,moduleConfig.debounceDelay);
        function generateColumnHtml(t){const e=utils.getFieldValue(t+"imageUrl"),o=utils.getFieldValue(t+"imageAlt"),n=utils.getFieldValue(t+"imageLink"),i=utils.getFieldValue(t+"showSubtitle"),l=utils.getFieldValue(t+"subtitle"),s=processRichText(utils.getFieldValue(t+"title")),a=processRichText(utils.getFieldValue(t+"description"),!0),d=utils.getFieldValue(t+"showButton"),r=utils.getFieldValue(t+"buttonText"),c=utils.getFieldValue(t+"buttonLink"),u=utils.getFieldValue(t+"subtitleFontSize"),g=utils.getFieldValue(t+"titleFontSize"),m=utils.getFieldValue(t+"descriptionFontSize"),p=utils.getFieldValue(t+"subtitleAlignment"),f=utils.getFieldValue(t+"titleAlignment"),h=utils.getFieldValue(t+"descriptionAlignment"),b=utils.getFieldValue(t+"buttonAlignment"),v=u+12,y=g+8,k=m+8,x="left"===p?"mobile-text-left":"mobile-text-center",S="left"===f?"mobile-text-left":"mobile-text-center",w="left"===h?"mobile-text-left":"mobile-text-center",L=i?`<tr><td class="${x}" style="color: #ffffff; font-family: 'Helvetica Neue LT W05_55 Roman', sans-serif, 'Open-Sans'; font-size: ${u}px; font-weight: normal; line-height: ${v}px; margin: 0; mso-line-height-rule: exactly; text-align: ${p}; mso-hyphenate: none; hyphens: none;">${l}</td></tr><tr><td><div style="clear: both; display: block; font-size: 8px; height: 8px; line-height: 8px; margin: 0px; mso-line-height-rule: exactly; padding: 0px;"> </div></td></tr>`:"",E=d?`<tr><td><div style="clear: both; display: block; font-size: 20px; height: 20px; line-height: 20px; margin: 0px; mso-line-height-rule: exactly; padding: 0px;"> </div></td></tr><tr><td><table align="center" border="0" cellpadding="0" cellspacing="0" class="sect" role="presentation" style="width: 100%;"><tr><td align="${b}" class="block" style="width: 100%;" valign="top"><table border="0" cellpadding="0" cellspacing="0" class="button-2-white" role="presentation" style="background-color: transparent; border: 2px solid #ffffff; border-collapse: separate; border-radius: 4px !important;"><tr><td align="center" style="border-radius: 4px !important; color: #ffffff; font-family: 'Helvetica Neue LT W05_55 Roman', sans-serif, 'Open-Sans'; font-size: 16px; font-weight: bold; line-height: 28px; mso-line-height-rule: exactly; mso-text-raise: 2px; padding: 12px 20px; text-align: center; text-transform: uppercase; width: 100%;"><a href="${c}" style="color: #ffffff; text-decoration: none;" target="_blank">${r}</a></td></tr></table></td></tr></table></td></tr><tr><td><div style="clear: both; display: block; font-size: 20px; height: 20px; line-height: 20px; margin: 0px; mso-line-height-rule: exactly; padding: 0px;"> </div></td></tr>`:"",z='<div style="clear: both; display: block; font-size: 12px; height: 12px; line-height: 12px; margin: 0; mso-line-height-rule: exactly; padding: 0;"> </div>';return`<td align="center" class="block" style="width: 280px;" valign="top"><table align="center" border="0" cellpadding="0" cellspacing="0" class="sect" role="presentation" style="width: 100%;"><tr><td><div><a href="${n}" target="_blank"><img align="top" alt="${o}" class="fill" src="${e}" style="border: none; display: block; height: auto; outline: none; text-decoration: none;" width="280"></a></div></td></tr><tr><td align="center" style="padding-bottom: 12px; padding-top: 12px;"><table border="0" cellpadding="0" cellspacing="0" class="sect" style="width: 100%;"><tr><td>${z}</td></tr>${L}<tr><td class="${S}" style="text-align: ${f};"><h3 style="color: #ffffff; font-family: 'Helvetica Neue LT W05_93 Blk E', Arial, sans-serif, 'Open-Sans'; font-size: ${g}px; font-stretch: condensed; font-weight: bold; line-height: ${y}px; margin: 0; text-transform: uppercase; mso-hyphenate: none; hyphens: none;">${s}</h3></td></tr><tr><td><div style="clear: both; display: block; font-size: 8px; height: 8px; line-height: 8px; margin: 0px; mso-line-height-rule: exactly; padding: 0px;"> </div></td></tr><tr><td class="${w}" style="color: #ffffff; font-family: 'Helvetica Neue LT W05_55 Roman', sans-serif, 'Open-Sans'; font-size: ${m}px; font-weight: normal; line-height: ${k}px; margin: 0; mso-line-height-rule: exactly; text-align: ${h}; mso-hyphenate: none; hyphens: none;">${a}</td></tr>${d?"":'<tr><td><div style="clear: both; display: block; font-size: 20px; height: 20px; line-height: 20px; margin: 0; mso-line-height-rule: exactly; padding: 0;"> </div></td></tr>'}${E}</table></td></tr></table></td>`}
        function generateTemplate(){const t="red"===utils.getFieldValue("backgroundColor")?"#DB021D":"#000000",e=generateColumnHtml("left_"),o=generateColumnHtml("right_");return`<!-- START .story-2col --><table align="center" border="0" cellpadding="0" cellspacing="0" class="content-outer" role="presentation" style="background-color: ${t}; width: 620px;"><tr><td class="side" style="width: 20px;"> </td><td align="center" class="content-inner" style="width: 580px;" valign="top"><table align="center" border="0" cellpadding="0" cellspacing="0" class="sect" role="presentation" style="width: 100%;"><tr>${e}<td class="gap block" style="width: 20px;"> </td>${o}</tr></table></td><td class="side" style="width: 20px;"> </td></tr></table><!-- END .story-2col -->`}
        function refreshPreview(){if(!state.isLoading&&state.sdk)try{const t=generateTemplate();state.sdk.setContent(t),state.sdk.setData&&state.sdk.setData({...state.blockData,content:t})}catch(t){utils.showError(`Preview update failed: ${t.message}`)}}
        function initializeEventHandlers(){state.eventListeners=[],document.querySelectorAll(".color-option").forEach(t=>{const e=e=>{updateData("backgroundColor",e.target.dataset.color),document.querySelectorAll(".color-option").forEach(t=>t.classList.remove("selected")),e.target.classList.add("selected")};t.addEventListener("click",e),state.eventListeners.push({element:t,event:"click",handler:e})});const t=["left_","right_"];t.forEach(t=>{["imageUrl","imageAlt","imageLink","subtitle","buttonText","buttonLink"].forEach(e=>{const o=elements[t+e],n=elements[t+e+"Error"],i=t+e,l=moduleConfig.fields[i],s=t=>{let e=t.target.value;l.validator,"url"!==l.validator||utils.isValidUrl(e)||(e=e.substring(0,l.maxLength)),t.target.value=e,debouncedUpdateData(i,e.trim())};o.addEventListener("input",s),state.eventListeners.push({element:o,event:"input",handler:s}),"url"===l.validator&&(()=>{const t=()=>utils.isValidUrl(o.value,n);o.addEventListener("blur",t),state.eventListeners.push({element:o,event:"blur",handler:t})})()}),["showSubtitle","showButton"].forEach(e=>{const o=elements[t+e],n=t+e,i=elements[t+("showSubtitle"===e?"subtitleGroup":"buttonFieldsGroup")],l=t=>{updateData(n,t.target.checked),i.classList.toggle("disabled-field",!t.target.checked)};o.addEventListener("change",l),state.eventListeners.push({element:o,event:"change",handler:l})}),setupNumberInput(elements[t+"subtitleFontSize"],t+"subtitleFontSize"),setupNumberInput(elements[t+"titleFontSize"],t+"titleFontSize"),setupNumberInput(elements[t+"descriptionFontSize"],t+"descriptionFontSize"),setupOptionSelector(elements[t+"subtitleAlignmentSelector"],t+"subtitleAlignment"),setupOptionSelector(elements[t+"titleAlignmentSelector"],t+"titleAlignment"),setupOptionSelector(elements[t+"descriptionAlignmentSelector"],t+"descriptionAlignment"),setupOptionSelector(elements[t+"buttonAlignmentSelector"],t+"buttonAlignment")});function setupNumberInput(t,e){if(!t)return;const o=4,n=n=>{const i=n.target;let l=parseInt(i.value,10);const s=parseInt(i.min,10),a=parseInt(i.max,10);isNaN(l)&&(l=moduleConfig.fields[e].defaultValue),l=Math.max(s,Math.min(l,a));const d=Math.round(l/o)*o;i.value=d,updateData(e,d)},i=t=>{const o=parseInt(t.target.value,10);isNaN(o)||debouncedUpdateData(e,o)};t.addEventListener("input",i),t.addEventListener("blur",n),state.eventListeners.push({element:t,event:"input",handler:i}),state.eventListeners.push({element:t,event:"blur",handler:n})}function setupOptionSelector(t,e){if(!t)return;t.querySelectorAll(".option-button").forEach(o=>{const n=n=>{const i=n.currentTarget;updateData(e,i.dataset.value),t.querySelectorAll(".option-button").forEach(t=>t.classList.remove("selected")),i.classList.add("selected")};o.addEventListener("click",n),state.eventListeners.push({element:o,event:"click",handler:n})})}}
        function loadData(){if(!state.sdk||!state.sdk.getData)return utils.showError("SDK not available");setLoadingState(!0),state.sdk.getData(t=>{try{state.blockData={},Object.keys(moduleConfig.fields).forEach(e=>{state.blockData[e]=t&&t.hasOwnProperty(e)?"richtext"===moduleConfig.fields[e].type?utils.sanitizeHtml(t[e]):t[e]:moduleConfig.fields[e].defaultValue});const e=utils.getFieldValue("backgroundColor");document.querySelectorAll(".color-option").forEach(t=>t.classList.toggle("selected",t.dataset.color===e));const o=["left_","right_"];o.forEach(t=>{["imageUrl","imageAlt","imageLink","subtitle","buttonText","buttonLink","subtitleFontSize","titleFontSize","descriptionFontSize"].forEach(e=>{elements[t+e]&&(elements[t+e].value=utils.getFieldValue(t+e))}),["title","description"].forEach(e=>{state.editors[t+e]&&(state.editors[t+e].root.innerHTML=utils.getFieldValue(t+e))}),["showSubtitle","showButton"].forEach(e=>{const o=utils.getFieldValue(t+e);elements[t+e].checked=o,elements[t+("showSubtitle"===e?"subtitleGroup":"buttonFieldsGroup")].classList.toggle("disabled-field",!o)}),["subtitleAlignment","titleAlignment","descriptionAlignment","buttonAlignment"].forEach(e=>{n(elements[t+e+"Selector"],t+e)})}),refreshPreview(),state.retryCount=0}catch(t){utils.showError(`Failed to load data: ${t.message}`),Object.keys(moduleConfig.fields).forEach(t=>{state.blockData[t]=moduleConfig.fields[t].defaultValue}),refreshPreview()}finally{setLoadingState(!1)}});function n(t,e){const o=utils.getFieldValue(e);t&&t.querySelectorAll(".option-button").forEach(t=>t.classList.toggle("selected",t.dataset.value===o))}}
        function cleanup(){Object.values(state.editors).forEach(t=>t&&t.off("text-change")),state.eventListeners.forEach(({element:t,event:e,handler:o})=>{t&&t.removeEventListener&&t.removeEventListener(e,o)}),state.eventListeners=[]}
        function initializeWithRetry(){try{if(!window.sfdc||!window.sfdc.BlockSDK)throw new Error("BlockSDK not loaded");if(!window.Quill)throw new Error("Quill not loaded");state.sdk=new window.sfdc.BlockSDK,cacheElements(),initializeEditors(),initializeEventHandlers(),loadData(),window.addEventListener("beforeunload",cleanup),document.addEventListener("visibilitychange",()=>{document.hidden||!state.isInitialized||loadData()}),state.isInitialized=!0}catch(t){utils.showError(`Initialization failed: ${t.message}`);let e=state.retryCount||0;e<moduleConfig.maxRetries?(state.retryCount=e+1,setTimeout(()=>initializeWithRetry(),1e3*state.retryCount)):utils.showError("Failed to initialize after multiple attempts. Please refresh.",!0),setLoadingState(!1)}}
        "loading"===document.readyState?document.addEventListener("DOMContentLoaded",initializeWithRetry):initializeWithRetry();
    </script>
</body>
</html>